<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Web Tool Hub</title>

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        primary: 'var(--color-primary)',
                        dark: {
                            bg: '#0f0a15',
                            surface: '#181024',
                            border: '#2d1b4e',
                            sidebar: '#130d1c'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --color-primary: #7f13ec;
        }

        body {
            background-color: #0f0a15;
            color: #e2e8f0;
        }

        /* Sidebar Styles */
        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            border-radius: 6px;
            color: #94a3b8;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .sidebar-link:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
        }

        .sidebar-link.active {
            background-color: var(--color-primary);
            color: white;
        }

        .pixel-card {
            background-color: #181024;
            border: 1px solid #2d1b4e;
            position: relative;
        }

        .glow-text {
            text-shadow: 0 0 10px rgba(127, 19, 236, 0.3);
        }
    </style>
</head>

<body class="flex h-screen overflow-hidden text-slate-300 antialiased font-sans">

    <!-- Sidebar -->
    <aside class="w-64 bg-dark-sidebar border-r border-dark-border flex flex-col justify-between hidden md:flex">
        <div class="p-6 border-b border-gray-200 dark:border-dark-border hidden md:flex items-center gap-3 mb-4">
            <div class="size-8 bg-primary rounded flex items-center justify-center text-white shadow-lg">
                <span class="material-symbols-outlined text-[20px]">terminal</span>
            </div>
            <div>
                <h2 class="text-white text-lg font-bold leading-none">DEV.HUB</h2>
                <span class="text-xs text-slate-500 font-mono">v2.4.0 (Pro)</span>
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto p-4 space-y-1">
            <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-3 mt-4" data-i18n="menu_main">
                Main</div>

            <a href="utilities.html" class="sidebar-link group">
                <span
                    class="material-symbols-outlined text-[20px] group-hover:text-primary transition-colors">grid_view</span>
                <span data-i18n="menu_dashboard">Dashboard</span>
            </a>

            <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-3 mt-6"
                data-i18n="menu_tools">Tools</div>

            <a href="text-tools.html" class="sidebar-link group">
                <span
                    class="material-symbols-outlined text-[20px] group-hover:text-primary transition-colors">code</span>
                <span>Code Tools</span>
            </a>
            <a href="image-tools.html" class="sidebar-link group">
                <span
                    class="material-symbols-outlined text-[20px] group-hover:text-primary transition-colors">image</span>
                <span>Image Tools</span>
            </a>
            <a href="unit-converter.html" class="sidebar-link group">
                <span
                    class="material-symbols-outlined text-[20px] group-hover:text-primary transition-colors">transform</span>
                <span>Converters</span>
            </a>

            <div class="h-px bg-dark-border my-4 mx-2"></div>

            <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 px-3" data-i18n="menu_config">
                Configuration</div>

            <a href="settings.html" class="sidebar-link group">
                <span class="material-symbols-outlined text-[20px]">settings</span>
                <span data-i18n="menu_settings">Settings</span>
            </a>

            <a href="profile.html" class="sidebar-link active">
                <span
                    class="material-symbols-outlined text-[20px] group-hover:text-primary transition-colors">person</span>
                <span data-i18n="menu_profile">Profile</span>
            </a>
        </nav>
        </div>

        <div class="p-6 border-t border-dark-border">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded bg-gradient-to-tr from-purple-500 to-pink-500 sidebar-avatar"></div>
                <div>
                    <p id="sidebar-username" class="text-sm font-medium text-white">Dev User</p>
                    <p class="text-xs text-slate-500">Pro Workspace</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto bg-dark-bg p-8 font-display">
        <div class="max-w-[1200px] mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-8">

            <!-- LEFT PANEL: Avatar & Info -->
            <div class="lg:col-span-4 flex flex-col gap-6">
                <div
                    class="pixel-card p-6 flex flex-col items-center gap-6 rounded-xl shadow-lg shadow-purple-900/10 h-full justify-between">
                    <div>
                        <!-- Avatar Container -->
                        <div class="relative group mx-auto mb-6 w-48">
                            <div
                                class="size-48 rounded-lg border-4 border-dark-border group-hover:border-primary transition-colors duration-300 overflow-hidden relative">
                                <img id="profile-avatar"
                                    src="https://lh3.googleusercontent.com/aida-public/AB6AXuDU4EJEnSdddlbq7xQ6e6VqPzUqk6Asm-sLFF8MLMLotw4UALiRkJu2KFUJl2_-T1bsl78Df7gOGXZQOZ_Mj8ajd5yumkFJ2uaFT2_7fHoFaBbwYiCf0C2jQrsvj6YafrlUzOzO4avitNBVv76bhe0YaS1DLq5PzAF4wPEJ-g4wSnd68TN3h5K07XYVSX3z_cj9vUwrKwQQ85eXRJa1fqdlRD0-Vtdedeie37R_5YvHrxapbZnCi1_Yk7tYyj8BcXy1veZKCPoRf7vu"
                                    class="w-full h-full object-cover transition-all duration-500" alt="Avatar">

                                <!-- Upload Overlay -->
                                <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity cursor-pointer"
                                    onclick="document.getElementById('avatar-upload').click()">
                                    <span class="material-symbols-outlined text-white text-3xl">upload</span>
                                </div>
                            </div>
                        </div>

                        <!-- Texts -->
                        <div class="w-full text-center space-y-2">
                            <h1 class="text-3xl font-bold tracking-tighter text-white glow-text" id="profile-name">
                                USER_404</h1>
                            <p class="text-primary font-bold text-sm tracking-widest uppercase"
                                id="profile-role-display">SYSTEM ARCHITECT</p>
                            <div
                                class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-green-500/10 border border-green-500/20">
                                <span class="size-2 rounded-full bg-green-500 animate-pulse"></span>
                                <span class="text-green-500 text-xs font-mono uppercase">Online</span>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden File Input -->
                    <input type="file" id="avatar-upload" accept="image/*" class="hidden" onchange="uploadAvatar(this)">

                    <button onclick="document.getElementById('avatar-upload').click()"
                        class="w-full py-4 bg-dark-bg hover:bg-dark-border border border-dark-border rounded-lg text-white text-xs font-bold uppercase tracking-wider transition-all flex items-center justify-center gap-2">
                        <span class="material-symbols-outlined text-sm">photo_camera</span>
                        Change Photo
                    </button>
                </div>
            </div>

            <!-- MIDDLE PANEL: Real Stats -->
            <div class="lg:col-span-5 flex flex-col gap-6">
                <div class="pixel-card rounded-xl h-full flex flex-col">
                    <div
                        class="bg-dark-surface border-b border-dark-border px-6 py-5 flex items-center justify-between">
                        <h2 class="text-white text-xs font-black uppercase tracking-[0.2em]">Activity_Log</h2>
                        <span class="material-symbols-outlined text-slate-600 text-sm">bar_chart</span>
                    </div>

                    <div class="p-8 grid grid-cols-1 sm:grid-cols-2 gap-6 flex-1">
                        <!-- Stat 1 -->
                        <div
                            class="bg-dark-bg p-6 border border-dark-border rounded-lg flex flex-col gap-2 hover:border-primary/50 transition-colors">
                            <div class="flex items-center gap-2 text-slate-500 mb-2">
                                <span class="material-symbols-outlined text-lg">login</span>
                                <span class="text-[10px] font-bold uppercase tracking-widest">Total Sessions</span>
                            </div>
                            <span class="text-4xl font-bold text-white" id="stat-sessions">0</span>
                        </div>

                        <!-- Stat 2 -->
                        <div
                            class="bg-dark-bg p-6 border border-dark-border rounded-lg flex flex-col gap-2 hover:border-primary/50 transition-colors">
                            <div class="flex items-center gap-2 text-slate-500 mb-2">
                                <span class="material-symbols-outlined text-lg">timer</span>
                                <span class="text-[10px] font-bold uppercase tracking-widest">Active Days</span>
                            </div>
                            <span class="text-4xl font-bold text-white" id="stat-days">1</span>
                        </div>

                        <!-- Stat 3 (Placeholder for future Project Count) -->
                        <div
                            class="bg-dark-bg p-6 border border-dark-border rounded-lg flex flex-col gap-2 hover:border-primary/50 transition-colors">
                            <div class="flex items-center gap-2 text-slate-500 mb-2">
                                <span class="material-symbols-outlined text-lg">folder_open</span>
                                <span class="text-[10px] font-bold uppercase tracking-widest">Projects</span>
                            </div>
                            <span class="text-4xl font-bold text-white">1</span> <!-- Static for now -->
                        </div>

                        <!-- Stat 4 -->
                        <div
                            class="bg-dark-bg p-6 border border-dark-border rounded-lg flex flex-col gap-2 hover:border-primary/50 transition-colors">
                            <div class="flex items-center gap-2 text-slate-500 mb-2">
                                <span class="material-symbols-outlined text-lg">palette</span>
                                <span class="text-[10px] font-bold uppercase tracking-widest">Theme Changes</span>
                            </div>
                            <span class="text-4xl font-bold text-white" id="stat-theme-changes">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT PANEL: Edit Identity -->
            <div class="lg:col-span-3 flex flex-col gap-6">
                <div class="pixel-card rounded-xl overflow-hidden h-full flex flex-col">
                    <div class="bg-dark-surface border-b border-dark-border px-6 py-5">
                        <h2 class="text-white text-xs font-black uppercase tracking-[0.2em]">Edit_Profile</h2>
                    </div>
                    <div class="p-6 space-y-6 flex-1">
                        <!-- Name Input -->
                        <div class="space-y-2">
                            <label class="text-slate-500 text-[10px] font-black uppercase tracking-widest">Display
                                Name</label>
                            <input id="input-handle"
                                class="w-full bg-dark-bg border border-dark-border focus:border-primary focus:ring-1 focus:ring-primary text-white font-mono text-sm px-4 py-3 rounded outline-none transition-all placeholder:text-slate-700"
                                type="text" placeholder="Enter your name..." />
                        </div>

                        <!-- Role Input (NEW) -->
                        <div class="space-y-2">
                            <label class="text-slate-500 text-[10px] font-black uppercase tracking-widest">Job Title /
                                Role</label>
                            <input id="input-role"
                                class="w-full bg-dark-bg border border-dark-border focus:border-primary focus:ring-1 focus:ring-primary text-white font-mono text-sm px-4 py-3 rounded outline-none transition-all placeholder:text-slate-700"
                                type="text" placeholder="e.g. Frontend Dev" />
                        </div>

                        <!-- Bio Input -->
                        <div class="space-y-2">
                            <label class="text-slate-500 text-[10px] font-black uppercase tracking-widest">Bio /
                                Notes</label>
                            <textarea id="input-bio"
                                class="w-full bg-dark-bg border border-dark-border focus:border-primary focus:ring-1 focus:ring-primary text-white font-mono text-sm px-4 py-3 rounded outline-none transition-all resize-none placeholder:text-slate-700"
                                rows="5" placeholder="Tell us about yourself..."></textarea>
                        </div>
                    </div>

                    <div class="p-6 pt-0 mt-auto">
                        <button onclick="saveProfile()"
                            class="w-full bg-primary hover:brightness-110 text-white text-sm font-bold py-4 rounded shadow-lg shadow-purple-900/20 transition-all uppercase tracking-widest">
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Scripts -->
    <script src="js/usage-stats.js"></script>
    <script src="settings.js"></script>
    <script>
        // ==========================================
        // PROFILE LOGIC
        // ==========================================

        function saveProfile() {
            const handle = document.getElementById('input-handle').value;
            const role = document.getElementById('input-role').value; // New Role Input
            const bio = document.getElementById('input-bio').value;

            // Get existing profile to preserve avatar
            const existing = JSON.parse(localStorage.getItem('user_profile') || '{}');
            const profile = { ...existing, handle, role, bio };

            localStorage.setItem('user_profile', JSON.stringify(profile));

            // Update UI immediately
            document.getElementById('profile-name').textContent = handle || 'USER_404';
            document.getElementById('profile-role-display').textContent = role || 'SYSTEM ARCHITECT';
            document.getElementById('sidebar-username').textContent = handle || 'Dev User';

            // Visual Feedback
            const btn = document.querySelector('button[onclick="saveProfile()"]');
            const originalText = btn.textContent;
            btn.textContent = "SAVED!";
            btn.style.backgroundColor = "#10b981";
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.backgroundColor = "";
            }, 1000);
        }

        function uploadAvatar(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const base64Image = e.target.result;

                    // Update Page Image
                    const img = document.getElementById('profile-avatar');
                    if (img) { img.src = base64Image; img.classList.remove('grayscale'); }

                    // Save
                    const existing = JSON.parse(localStorage.getItem('user_profile') || '{}');
                    existing.avatar = base64Image;
                    localStorage.setItem('user_profile', JSON.stringify(existing));

                    // Update Sidebar
                    updateGlobalAvatars(base64Image);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function updateGlobalAvatars(src) {
            const sidebarAvatars = document.querySelectorAll('.sidebar-avatar');
            sidebarAvatars.forEach(div => {
                div.style.backgroundImage = `url('${src}')`;
                div.style.backgroundSize = 'cover';
                div.style.backgroundPosition = 'center';
                div.classList.remove('bg-gradient-to-tr');
            });
        }

        // ==========================================
        // STATS LOGIC (Using Real Usage Stats)
        // ==========================================
        function initStats() {
            if (!window.usageStats) {
                console.warn('Usage stats not loaded yet');
                return;
            }

            const stats = window.usageStats.getAllStats();

            // 1. Total Sessions
            document.getElementById('stat-sessions').textContent = stats.totalSessions || 0;

            // 2. Active Days
            document.getElementById('stat-days').textContent = stats.totalActiveDays || 1;

            // 3. Tools Used (replacing Projects)
            const toolsUsedStat = document.querySelector('#stat-days').closest('.bg-dark-bg').nextElementSibling;
            if (toolsUsedStat) {
                const label = toolsUsedStat.querySelector('.tracking-widest');
                const value = toolsUsedStat.querySelector('.text-4xl');
                if (label) label.textContent = 'Tools Used';
                if (value) value.textContent = stats.totalToolsUsed || 0;

                const icon = toolsUsedStat.querySelector('.material-symbols-outlined');
                if (icon) icon.textContent = 'build';
            }

            // 4. Theme Changes
            document.getElementById('stat-theme-changes').textContent = stats.themeChanges || 0;
        }

        function loadProfile() {
            const saved = localStorage.getItem('user_profile');
            if (saved) {
                const profile = JSON.parse(saved);

                // Form Inputs
                if (profile.handle) document.getElementById('input-handle').value = profile.handle;
                if (profile.role) document.getElementById('input-role').value = profile.role;
                if (profile.bio) document.getElementById('input-bio').value = profile.bio;

                // Display Values
                if (profile.handle) {
                    document.getElementById('profile-name').textContent = profile.handle;
                    document.getElementById('sidebar-username').textContent = profile.handle;
                }
                if (profile.role) document.getElementById('profile-role-display').textContent = profile.role;

                // Avatar
                if (profile.avatar) {
                    const img = document.getElementById('profile-avatar');
                    if (img) { img.src = profile.avatar; img.classList.remove('grayscale'); }
                    updateGlobalAvatars(profile.avatar);
                }
            } else {
                // Initialize Defaults
                document.getElementById('input-role').value = "System Architect";
            }

            initStats();
        }

        document.addEventListener('DOMContentLoaded', loadProfile);
    </script>
</body>

</html>